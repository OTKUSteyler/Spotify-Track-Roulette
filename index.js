(function(n,u,y,t){"use strict";const l=y.findByProps("sendMessage","editMessage"),a=y.findByStoreName("SpotifyStore");t.storage.trackHistory||(t.storage.trackHistory=[]);let d=null,i=null;function f(){const r=a?.getActivity();if(!r)return;const e=r.sync_id||r.session_id,o=r.details,s=r.state?.replace("by ","");if(e&&o&&s&&e!==d){d=e;const k={id:e,name:o,artist:s,url:`https://open.spotify.com/track/${e}`,timestamp:Date.now()};t.storage.trackHistory.some(function(h){return h.id===e})||(t.storage.trackHistory.push(k),t.storage.trackHistory.length>200&&t.storage.trackHistory.shift())}}function m(){if(!t.storage.trackHistory||t.storage.trackHistory.length===0)return"\u274C No tracks in history yet! Play some music on Spotify and try again later.";const r=a?.getActivity(),e=r?.sync_id||r?.session_id;let o=t.storage.trackHistory;return t.storage.trackHistory.length>1&&e&&(o=t.storage.trackHistory.filter(function(s){return s.id!==e})),o.length===0&&(o=t.storage.trackHistory),o[Math.floor(Math.random()*o.length)].url}let c;var g={onLoad:function(){i=a?.addChangeListener?.(f),f(),c=u.registerCommand({name:"spotifyroulette",displayName:"Spotify Roulette",description:"Sends a random track from your Spotify history",options:[],execute:async function(r,e){const o=m();l.sendMessage(e.channel.id,{content:o},void 0,{nonce:Date.now().toString()})},applicationId:"-1",inputType:1,type:1})},onUnload:function(){c&&c(),i&&i()}};return n.default=g,Object.defineProperty(n,"__esModule",{value:!0}),n})({},vendetta.commands,vendetta.metro,vendetta.plugin);
